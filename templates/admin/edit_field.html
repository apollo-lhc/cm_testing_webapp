{% extends "base.html" %}
{% block title %}Edit Field{% endblock %}

{% block page_title %}Apollo CM Form Editor â€¢ Edit Field{% endblock %}

{% block content %}
<div style="height: 25px;"></div>


<div style="font-size: 1rem;">
  <form method="post" action="{{ url_for('form_editor.edit_field', page_idx=page_idx, field_idx=field_idx) }}">

  <div class="mb-3">
    <label class="form-label"><strong>Label</strong> (Required):</label>
    <textarea name="label" rows="2" required class="form-control">{{ field.label or '' }}</textarea>
  </div>

  <div class="mb-3">
    <label class="form-label"><strong>Name</strong> (Required, unique page ID for linking help cards):</label>
    <input type="text" name="name" value="{{ field.name or '' }}" required class="form-control ">
  </div>

  <div class="mb-3">
    <label class="form-label"><strong>Field Type</strong> (Required):</label>
    <select name="type" id="field-type" onchange="adjustFieldOptions()" required class="form-select form-select-lg">
      {% for type in ['text', 'integer', 'float', 'boolean', 'file', 'null', 'blank', 'help_instance'] %}
        <option value="{{ type }}" {% if field.type_field == type %}selected{% endif %}>{{ type }}</option>
      {% endfor %}
    </select>
  </div>

  <div id="help-text-group" class="mb-3">
    <label class="form-label"><strong>Help Text</strong> (Optional):</label>
    <textarea name="help_text" rows="4" class="form-control ">{{ field.help_text or '' }}</textarea>
  </div>

  <div id="help-link-group" class="mb-3">
    <label class="form-label"><strong>Help Link</strong> (Optional):</label>
    <input type="url" name="help_link" value="{{ field.help_link or '' }}" class="form-control ">
  </div>

  <div id="help-label-group" class="mb-3">
    <label class="form-label"><strong>Help Label</strong> (Optional):</label>
    <input type="text" name="help_label" value="{{ field.help_label or '' }}" class="form-control ">
  </div>

  <div id="help-target-group" class="mb-3">
    <label class="form-label"><strong>Help Target</strong> (Optional â€” create link to this help object by placing name here):</label>
    <input type="text" name="help_target" value="{{ field.help_target or '' }}" class="form-control ">
  </div>

  <div id="display-form-group" class="form-check form-switch mb-3">
    <input type="checkbox" class="form-check-input" id="display_form" name="display_form" value="1" {% if field.display_form %}checked{% endif %}>
    <label class="form-check-label" for="display_form"><strong>Show in Form</strong></label>
  </div>

  <div id="display-history-group" class="form-check form-switch mb-4">
    <input type="checkbox" class="form-check-input" id="display_history" name="display_history" value="1" {% if field.display_history %}checked{% endif %}>
    <label class="form-check-label" for="display_history"><strong>Show in History</strong></label>
  </div>

  <button type="submit" class="btn btn-success  me-3">ðŸ’¾ Save Changes</button>
  <a href="{{ url_for('form_editor.list_forms') }}" class="btn btn-outline-secondary ">Cancel</a>
</form>

<script>
  function adjustFieldOptions() {
    const type = document.getElementById("field-type").value;
    const show = id => document.getElementById(id).style.display = "block";
    const hide = id => document.getElementById(id).style.display = "none";

    ["help-text-group", "help-link-group", "help-label-group", "help-target-group", "display-form-group", "display-history-group"]
      .forEach(show);

    if (type === "blank") {
      hide("help-text-group");
      hide("help-link-group");
      hide("help-label-group");
      hide("help-target-group");
      hide("display-form-group");
      hide("display-history-group");
    }

    if (type === "help_instance") {
      show("help-text-group");
      show("help-link-group");
      show("help-label-group");
      hide("display-form-group");
      hide("display-history-group");
    }

    if (type === "null") {
      show("help-text-group");
      show("help-link-group");
      show("help-label-group");
    }
  }

  window.onload = adjustFieldOptions;
</script>
<div style="height: 100px;"></div>

{% endblock %}
